                                                          <!DOCTYPE html>
                                                          <html lang="pt-br">
                                                          <head>
                                                            <meta charset="UTF-8">
                                                            <title>Painel de Agendamentos</title>
                                                            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
                                                            <!-- Adiciona jQuery e plugins para máscara -->
                                                            <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
                                                            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
                                                            <style>
                                                              @media (max-width: 768px) {
                                                                body, label, input, select, th, td, button, h2, h4 {
                                                                  font-size: 20px !important;
                                                                }
                                                                .form-control, .form-select, .btn {
                                                                  min-height: 56px;
                                                                  font-size: 20px;
                                                                }
                                                                .tabela-scroll { display: none; }
                                                                .agenda-card-mobile { display: block; }
                                                              }
                                                              @media (min-width: 769px) {
                                                                .agenda-card-mobile { display: none; }
                                                              }
                                                            </style>
                                                          </head>
                                                          <body class="bg-light">
                                                            <div class="container mt-5">
                                                              <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
                                                                <h2>Painel de Agendamentos</h2>
                                                                <div class="mt-2 mt-md-0">
                                                                  <span class="me-3">Olá, <b><%= user %></b></span>
                                                                  <a href="/logout" class="btn btn-outline-danger btn-sm">Sair</a>
                                                                </div>
                                                              </div>

                                                              <div class="card p-4 mb-4">
                                                                <h4 class="mb-3">Novo Agendamento</h4>
                                                                <form method="post" action="/agendar" onsubmit="return validarFormulario();">
                                                                  <div class="row g-3">
                                                                    <div class="col-12">
                                                                      <label for="cliente" class="form-label">Cliente</label>
                                                                      <input type="text" class="form-control" id="cliente" name="cliente" required>
                                                                    </div>
                                                                    <div class="col-12">
                                                                      <label for="telefone" class="form-label">Telefone</label>
                                                                      <input type="text" class="form-control" id="telefone" name="telefone" required>
                                                                    </div>
                                                                    <div class="col-12">
                                                                      <label for="cpf" class="form-label">CPF</label>
                                                                      <input type="text" class="form-control" id="cpf" name="cpf" maxlength="14" required>
                                                                    </div>
                                                                    <div class="col-12">
                                                                      <label for="nascimento" class="form-label">Nascimento</label>
                                                                      <input type="date" class="form-control" id="nascimento" name="nascimento" required>
                                                                    </div>
                                                                    <div class="col-12">
                                                                      <label for="servico" class="form-label">Serviço</label>
                                                                      <input type="text" class="form-control" id="servico" name="servico" required>
                                                                    </div>
                                                                    <div class="col-12">
                                                                      <label for="datahora" class="form-label">Data e Hora</label>
                                                                      <input type="datetime-local" class="form-control" id="datahora" name="datahora" required>
                                                                    </div>
                                                                    <div class="col-12">
                                                                      <label for="funcionaria" class="form-label">Funcionária</label>
                                                                      <select class="form-select" id="funcionaria" name="funcionaria" required>
                                                                        <option value="">Selecione</option>
                                                                        <option value="marcones">Sogra (Marcones)</option>
                                                                        <option value="analaura">Ana Laura</option>
                                                                        <option value="luiza">Luiza</option>
                                                                      </select>
                                                                    </div>
                                                                  </div>
                                                                  <button type="submit" class="btn btn-success mt-3 w-100">Agendar</button>
                                                                </form>
                                                              </div>

                                                              <!-- TABELA para desktop -->
                                                              <div class="card p-4 tabela-scroll">
                                                                <h4 class="mb-3">Todos os Agendamentos</h4>
                                                                <table class="table table-bordered table-hover align-middle mb-0">
                                                                  <thead>
                                                                    <tr>
                                                                      <th>Cliente</th>
                                                                      <th>Telefone</th>
                                                                      <th>CPF</th>
                                                                      <th>Nascimento</th>
                                                                      <th>Serviço</th>
                                                                      <th>Data/Hora</th>
                                                                      <th>Funcionária</th>
                                                                      <th>Ação</th>
                                                                    </tr>
                                                                  </thead>
                                                                  <tbody>
                                                                  <% if (agendamentos.length === 0) { %>
                                                                    <tr>
                                                                      <td colspan="8" class="text-center">Nenhum agendamento cadastrado.</td>
                                                                    </tr>
                                                                  <% } else { %>
                                                                    <% agendamentos.forEach(a => { %>
                                                                      <tr>
                                                                        <td><%= a.cliente %></td>
                                                                        <td><%= a.telefone %></td>
                                                                        <td><%= a.cpf || "" %></td>
                                                                        <td><%= a.nascimento || "" %></td>
                                                                        <td><%= a.servico %></td>
                                                                        <td><%= a.datahora.replace("T", " ") %></td>
                                                                        <td>
                                                                          <% if (a.funcionaria === "marcones") { %> Sogra (Marcones)
                                                                          <% } else if (a.funcionaria === "analaura") { %> Ana Laura
                                                                          <% } else if (a.funcionaria === "luiza") { %> Luiza
                                                                          <% } else { %> <%= a.funcionaria %> <% } %>
                                                                        </td>
                                                                        <td>
                                                                          <form method="post" action="/apagar/<%= a.id %>" onsubmit="return confirm('Tem certeza que deseja apagar este agendamento?')">
                                                                            <button type="submit" class="btn btn-sm btn-danger">Apagar</button>
                                                                          </form>
                                                                        </td>
                                                                      </tr>
                                                                    <% }); %>
                                                                  <% } %>
                                                                  </tbody>
                                                                </table>
                                                              </div>

                                                              <!-- CARDS para mobile -->
                                                              <div class="agenda-card-mobile">
                                                                <h4 class="mb-3">Todos os Agendamentos</h4>
                                                                <% if (agendamentos.length === 0) { %>
                                                                  <div class="alert alert-light text-center">Nenhum agendamento cadastrado.</div>
                                                                <% } else { %>
                                                                  <% agendamentos.forEach(a => { %>
                                                                    <div class="card mb-3 p-3 shadow-sm">
                                                                      <div><b>Cliente:</b> <%= a.cliente %></div>
                                                                      <div><b>Telefone:</b> <%= a.telefone %></div>
                                                                      <div><b>CPF:</b> <%= a.cpf || "" %></div>
                                                                      <div><b>Nascimento:</b> <%= a.nascimento || "" %></div>
                                                                      <div><b>Serviço:</b> <%= a.servico %></div>
                                                                      <div><b>Data/Hora:</b> <%= a.datahora.replace("T", " ") %></div>
                                                                      <div><b>Funcionária:</b>
                                                                        <% if (a.funcionaria === "marcones") { %> Sogra (Marcones)
                                                                        <% } else if (a.funcionaria === "analaura") { %> Ana Laura
                                                                        <% } else if (a.funcionaria === "luiza") { %> Luiza
                                                                        <% } else { %> <%= a.funcionaria %> <% } %>
                                                                      </div>
                                                                      <form method="post" action="/apagar/<%= a.id %>" class="mt-2" onsubmit="return confirm('Tem certeza que deseja apagar este agendamento?')">
                                                                        <button type="submit" class="btn btn-danger w-100">Apagar</button>
                                                                      </form>
                                                                    </div>
                                                                  <% }); %>
                                                                <% } %>
                                                              </div>
                                                            </div>

                                                            <!-- MÁSCARAS E VALIDAÇÃO -->
                                                            <script>
                                                              $(document).ready(function() {
                                                                $('#telefone').mask('(00) 00000-0000');
                                                                $('#cpf').mask('000.000.000-00', {reverse: true});
                                                              });

                                                              function validarCPF(cpf) {
                                                                cpf = cpf.replace(/[^\d]+/g,'');
                                                                if (cpf.length !== 11 || /^(\d)\1+$/.test(cpf)) return false;
                                                                let soma = 0, resto;
                                                                for (let i = 1; i <= 9; i++) soma += parseInt(cpf.substring(i-1, i)) * (11 - i);
                                                                resto = (soma * 10) % 11;
                                                                if (resto === 10 || resto === 11) resto = 0;
                                                                if (resto !== parseInt(cpf.substring(9, 10))) return false;
                                                                soma = 0;
                                                                for (let i = 1; i <= 10; i++) soma += parseInt(cpf.substring(i-1, i)) * (12 - i);
                                                                resto = (soma * 10) % 11;
                                                                if (resto === 10 || resto === 11) resto = 0;
                                                                if (resto !== parseInt(cpf.substring(10, 11))) return false;
                                                                return true;
                                                              }

                                                              function validarFormulario() {
                                                                let cpf = document.getElementById('cpf').value;
                                                                if (!validarCPF(cpf)) {
                                                                  alert('CPF inválido!');
                                                                  document.getElementById('cpf').focus();
                                                                  return false;
                                                                }
                                                                // Validar telefone se quiser (opcional)
                                                                // let tel = document.getElementById('telefone').value;
                                                                // if (tel.length < 14) { alert('Telefone inválido!'); return false; }
                                                                return true;
                                                              }
                                                            </script>
                                                          </body>
                                                          </html>
